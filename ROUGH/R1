I have been handed over a task worked on by another developer and i need to fix the code according to the review comments please help me, first i'll be sharing all the codes, do save it in your files:

1) src/main/java/com/personalcapital/salesforce/sps/entity/SpsCirrusContactMetadata.java
package com.personalcapital.salesforce.sps.entity;

import com.personalcapital.data.repository.BaseEntity;
import com.personalcapital.salesforce.sps.enums.DataSource;
import com.personalcapital.salesforce.sps.enums.DataSourceConverter;
import com.personalcapital.salesforce.sps.enums.RegistrationStatus;
import com.personalcapital.salesforce.sps.enums.UserSpsPlanType;
import jakarta.persistence.*;
import lombok.*;
import org.hibernate.annotations.GenericGenerator;

import java.util.Date;
import java.util.UUID;

@Data
@NoArgsConstructor
@AllArgsConstructor
@EqualsAndHashCode(callSuper = true)
@Entity
@Table(name = "sps_cirrus_contact_metadata", catalog = "sp_schema")
public class SpsCirrusContactMetadata extends BaseEntity
{
	@Id
	@GeneratedValue(generator = "uuid2")
	@GenericGenerator(name = "uuid2", strategy = "org.hibernate.id.UUIDGenerator")
	@Column(name = "metadata_id", columnDefinition = "BINARY(16)")
	private UUID metadataId;

	@Column(name = "user_account_guid", columnDefinition = "BINARY(16)")
	private UUID userAccountGuid;

	@Column(name = "persona_id", columnDefinition = "BINARY(16)")
	private UUID personaId;

	@Column(name = "hash_value")
	private Integer hashValue;

	@Column(name = "persona_details_json", columnDefinition = "JSON")
	private String personaAltIds;

	@Convert(converter = DataSourceConverter.class)
	@Column(name = "data_source", columnDefinition = "ENUM('ACCOUNT','C&H')")
	private DataSource dataSource;

	@Column(name = "user_sps_plan_type") // enum1
	@Enumerated(EnumType.STRING)
	private UserSpsPlanType userSpsPlanType;

	@Column(name = "registration_status")
	@Enumerated(EnumType.STRING)
	private RegistrationStatus registrationStatus;

	@Column(name = "retry_count")
	private int retryCount;

	@Column(name = "created_date")
	private Date createdDate;

	@Column(name = "updated_date")
	private Date updatedDate;

	public SpsCirrusContactMetadata(UUID metadataId, UUID userAccountGuid, UUID personaId,
									UserSpsPlanType userSpsPlanType, RegistrationStatus registrationStatus)
	{
		this.metadataId = metadataId;
		this.userAccountGuid = userAccountGuid;
		this.personaId = personaId;
		this.userSpsPlanType = userSpsPlanType;
		this.registrationStatus = registrationStatus;
	}
}


2) src/main/java/com/personalcapital/salesforce/sps/enums/DataSource.java
package com.personalcapital.salesforce.sps.enums;

public enum DataSource
{
	ACCOUNT("ACCOUNT"),C_AND_H("C&H");

	private final String dbValue;
	DataSource(String dbValue) { this.dbValue = dbValue; }
	public String getDbValue() { return dbValue; }

	public static DataSource fromDb(String v) {
		if (v == null) return null;
		return switch (v) {
			case "ACCOUNT" -> ACCOUNT;
			case "C&H" -> C_AND_H;
			default -> throw new IllegalArgumentException("Unknown data_source: " + v);
		};
	}
}

3)src/main/java/com/personalcapital/salesforce/sps/enums/DataSourceConverter.java
package com.personalcapital.salesforce.sps.enums;

import jakarta.persistence.AttributeConverter;
import jakarta.persistence.Converter;

@Converter(autoApply = false)
public class DataSourceConverter implements AttributeConverter<DataSource, String> {
    @Override
    public String convertToDatabaseColumn(DataSource attribute) {
        return attribute == null ? null : attribute.getDbValue();
    }

    @Override
    public DataSource convertToEntityAttribute(String dbData) {
        return DataSource.fromDb(dbData);
    }
}

4)src/main/java/com/personalcapital/salesforce/sps/enums/RegistrationStatus.java
package com.personalcapital.salesforce.sps.enums;

public enum RegistrationStatus
{
	COMPLETED, EXPIRED, FAILED, PENDING
}

5)src/main/java/com/personalcapital/salesforce/sps/enums/UserSpsPlanType.java
package com.personalcapital.salesforce.sps.enums;

public enum UserSpsPlanType
{
	CONFORMING, NON_CONFORMING
}

6)src/main/java/com/personalcapital/salesforce/sps/repository/SpsCirrusContactMetadataRepository.java
package com.personalcapital.salesforce.sps.repository;

import com.personalcapital.salesforce.sps.enums.RegistrationStatus;
import com.personalcapital.salesforce.sps.entity.SpsCirrusContactMetadata;
import jakarta.persistence.PersistenceContext;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Slice;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.UUID;

@Repository
@PersistenceContext(unitName = "sp_schema") // sp_schema is db
public interface SpsCirrusContactMetadataRepository
		extends JpaRepository<SpsCirrusContactMetadata, UUID>
{
	@Transactional(readOnly = true)
	SpsCirrusContactMetadata findByMetadataId(UUID metadataId);

	@Transactional(readOnly = true)
	Slice<SpsCirrusContactMetadata> findByRegistrationStatus(
            RegistrationStatus registrationStatus, Pageable pageable);

	@Transactional(readOnly = true)
	@Query("SELECT * FROM SpsCirrusContactMetadataEntity m where m.metadataId in (:metadataId)")
	List<SpsCirrusContactMetadata> findExistingUsersByMetadataId(
            @Param("metadataId") UUID metadataId);

	@Transactional(readOnly = true)
	@Query("SELECT * FROM sp_schema.sps_cirrus_contact_metadata WHERE user_account_guid = :userAccountId AND persona_id = :personaId")
	List<SpsCirrusContactMetadata> findByUserAccountIdPersonaId(
            @Param("userAccountGuid") UUID userAccountGuid, @Param("personaId") UUID personaId);

	@Transactional(readOnly = true)
	@Query("SELECT hash_value FROM sp_schema.sps_cirrus_contact_metadata WHERE user_account_guid = :userAccountGuid ORDER BY updated_date DESC and LIMIT 1")
	List<SpsCirrusContactMetadata> findLastestHashByUserAccountGuid(
			@Param("userAccountGuid") UUID userAccountGuid);

	@Modifying
	@Transactional(readOnly = true)
	@Query("UPDATE sp_schema.sps_cirrus_contact_metadata registration_status = :status WHERE user_account_guid = :userAccountGuid AND persona_id = :personaId")
	int setStatus(@Param("userAccountGuid") UUID userAccountGuid, @Param("personaId") UUID personaId,
                  @Param("status") String registrationStatus);

	@Modifying
	@Transactional
	@Query("UPDATE sp_schema.sps_cirrus_contact_metadata SET retry_count = retry_count + 1  WHERE metadata_id = :metadataId")
	int incrementRetry(@Param("metadataId") UUID metadataId);

	// getEntriesByStatus(registrationStatus)
	@Transactional(readOnly = true)
	@Query("SELECT * FROM sp_schema.sps_cirrus_contact_metadata WHERE registration_status = :status")
	List<SpsCirrusContactMetadata> getEntriesByStatus(
            @Param("status") String registrationStatus);
}


7) test file
package com.personalcapital.salesforce.sps;

import com.personalcapital.salesforce.sps.entity.SpsCirrusContactMetadata;
import com.personalcapital.salesforce.sps.repository.SpsCirrusContactMetadataRepository;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.mockito.ArgumentCaptor;
import org.mockito.Mock;

import java.util.UUID;

import static org.junit.Assert.assertEquals;
import static org.junit.jupiter.api.Assertions.assertSame;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.mockito.Mockito.*;


class SpsCirrusContactMetadataRepositoryTest {

	@Mock
	private SpsCirrusContactMetadataRepository repository;

	@Test
	void findByMetadataId_returnsEntity() {
		assertThrows(NullPointerException.class, () -> {
			// Code expected to throw NPE
			UUID id = UUID.randomUUID();
			SpsCirrusContactMetadata entity = new SpsCirrusContactMetadata();
			SpsCirrusContactMetadata result = repository.findByMetadataId(id);
			Assertions.assertNotNull(result);
			assertSame(entity, result);
			verify(repository, times(1)).findByMetadataId(id);
			verifyNoMoreInteractions(repository);
		});
	}

	@Test
	void setStatus_returnsUpdatedCount() {
		assertThrows(NullPointerException.class, () -> {
			UUID userAccountId = UUID.randomUUID();
			UUID personaId = UUID.randomUUID();
			String status = "APPROVED";

			when(repository.setStatus(userAccountId, personaId, status)).thenReturn(1);

			int updated = repository.setStatus(userAccountId, personaId, status);

			assertEquals(1, updated);
			verify(repository, times(1)).setStatus(userAccountId, personaId, status);
			verifyNoMoreInteractions(repository);
		});
	}

	@Test
	void incrementRetry_returnsUpdatedCount() {
		assertThrows(NullPointerException.class, () -> {
			UUID metadataId = UUID.randomUUID();
			when(repository.incrementRetry(metadataId)).thenReturn(1);

			int updated = repository.incrementRetry(metadataId);

			assertEquals(1, updated);
			verify(repository, times(1)).incrementRetry(metadataId);
			verifyNoMoreInteractions(repository);
		});
	}

	@Test
	void methodArguments_arePassedThrough() {
		assertThrows(NullPointerException.class, () -> {
			// Optional: capture arguments to ensure pass-through correctness
			UUID userAccountId = UUID.randomUUID();
			UUID personaId = UUID.randomUUID();
			String status = "FAILED";

			when(repository.setStatus(any(), any(), any())).thenReturn(2);

			repository.setStatus(userAccountId, personaId, status);

			ArgumentCaptor<UUID> userCap = ArgumentCaptor.forClass(UUID.class);
			ArgumentCaptor<UUID> personaCap = ArgumentCaptor.forClass(UUID.class);
			ArgumentCaptor<String> statusCap = ArgumentCaptor.forClass(String.class);

			verify(repository).setStatus(userCap.capture(), personaCap.capture(), statusCap.capture());
			assertEquals(userAccountId, userCap.getValue());
			assertEquals(personaId, personaCap.getValue());
			assertEquals(status, statusCap.getValue());
			verifyNoMoreInteractions(repository);
		});
	}
}








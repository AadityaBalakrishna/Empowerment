package com.empower.epw.crm.gateway.sqs;

import io.awspring.cloud.sqs.operations.SqsTemplate; // Import SqsTemplate
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
// We don't need @Value anymore
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.context.TestPropertySource;

import lombok.CustomLog;

@CustomLog
@SpringBootTest
@ActiveProfiles("test")
@TestPropertySource(properties =
{
	"crm.gateway.listener.enabled=false",
    
    // We don't need the producer service for this test
	"crm.gateway.producer.enabled=false", 
    
    // We still need the region to be correct
	"spring.cloud.aws.region.static=${JENKINS_REGION:us-west-2}"
})
public class CrmGatewayMessageProducerTest
{
    // Inject SqsTemplate directly
	@Autowired
	private SqsTemplate sqsTemplate;

    // These MUST be the full, correct URLs for the queues
    // in account 179355710817
    private static final String DRY_RUN_QUEUE_URL = "https://sqs.us-west-2.amazonaws.com/179355710817/DEVTRUNK_CRM_GATEWAY_DRY_RUN";
    private static final String INTERMEDIATE_QUEUE_URL = "https://sqs.us-west-2.amazonaws.com/179355710817/DEVTRUNK_CRM_GATEWAY_INTERMEDIATE";
    private static final String NORMAL_QUEUE_URL = "https://sqs.us-west-2.amazonaws.com/179355710817/DEVTRUNK_CRM_GATEWAY_NORMAL";
    private static final String TOP_QUEUE_URL = "https://sqs.us-west-2.amazonaws.com/179355710817/DEVTRUNK_CRM_GATEWAY_TOP";

	@Test
	void sendMessagesToLiveAwsQueues()
	{
		String successPayload = "{\"event\":\"CROSS_ACCOUNT_TEST\"}";

		log.info("--- Sending messages to REAL AWS SQS queues using full URLs ---");

		log.info("Sending 'success' message to DRY_RUN...");
		sqsTemplate.send(DRY_RUN_QUEUE_URL, successPayload);

		log.info("Sending 'success' message to INTERMEDIATE...");
		sqsTemplate.send(INTERMEDIATE_QUEUE_URL, successPayload);

		log.info("Sending 'success' message to NORMAL...");
		sqsTemplate.send(NORMAL_QUEUE_URL, successPayload);

		log.info("Sending 'success' message to TOP...");
		sqsTemplate.send(TOP_QUEUE_URL, successPayload);
        
        log.info("--- All messages sent. Check the MR container logs. ---");
	}
}

package com.personalcapital.config;

import org.junit.jupiter.api.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.env.Environment;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit.jupiter.SpringJUnitConfig;

import static org.junit.jupiter.api.Assertions.assertNotNull;

@SpringJUnitConfig(locations = "classpath:pcapConfigApplicationContext.xml")
@ContextConfiguration(locations = "classpath:pcapConfigApplicationContext.xml")
public class TestConfig {

    private static final Logger logger = LoggerFactory.getLogger(TestConfig.class);

    @Autowired
    private Environment environment;

    @Test
    public void testProfiles() {
        // Retrieve properties from the environment
        String awsAccount = environment.getProperty("aws.account", "defaultAccount");
        String identityStage = environment.getProperty("identity.stage", "defaultStage");
        String identityParentStage = environment.getProperty("identity.parentStage", "defaultParentStage");

        // Assert that the environment properties are not null
        assertNotNull(awsAccount, "AWS Account should not be null");
        assertNotNull(identityStage, "Identity Stage should not be null");

        // Infer profiles manually for testing
        String inferredProfile;
        if (!identityParentStage.isBlank()) {
            inferredProfile = String.join(",", awsAccount + "-shared", identityParentStage, identityStage);
        } else {
            inferredProfile = String.join(",", awsAccount + "-shared", identityStage);
        }

        // Log the inferred profile
        logger.info("Inferred Profile: {}", inferredProfile);

        // Example assertion (optional, modify as needed)
        assertNotNull(inferredProfile, "Inferred profile should not be null");
    }
}
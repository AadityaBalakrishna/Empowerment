#!/bin/bash

# A simple script to send a message to the SqsDebugController
#
# Usage:
# ./send-sqs.sh <host_url> <queue_type> <payload>
#
# Example:
# ./send-sqs.sh "https.pcsvc.dt.pcapqa.app/crm-gateway-mr-11" "normal" '{"id": 123, "test": "hello"}'
#

# --- Input Validation ---
if [ "$#" -ne 3 ]; then
    echo "Usage: $0 <host_url> <queue_type> <payload>"
    echo "  <host_url>   - The full base URL (e.g., https://pcsvc.dt.pcapqa.app/crm-gateway-mr-11)"
    echo "  <queue_type> - One of: dryrun, intermediate, normal, top"
    echo "  <payload>    - The JSON payload as a string (e.g., '{\"id\": 123}')"
    exit 1
fi

HOST_URL=$1
QUEUE_TYPE=$2
PAYLOAD=$3

# --- Determine Endpoint ---
ENDPOINT=""
case $QUEUE_TYPE in
  dryrun)
    ENDPOINT="/api/debug/send-dryrun"
    ;;
  intermediate)
    ENDPOINT="/api/debug/send-intermediate"
    ;;
  normal)
    ENDPOINT="/api/debug/send-normal"
    ;;
  top)
    ENDPOINT="/api/debug/send-top"
    ;;
  *)
    echo "Error: Invalid queue_type '$QUEUE_TYPE'. Must be one of: dryrun, intermediate, normal, top"
    exit 1
    ;;
esac

FULL_URL="${HOST_URL}${ENDPOINT}"

# --- Execute Command ---
echo "Sending payload to: $FULL_URL"
echo "Payload: $PAYLOAD"
echo "---"

curl -X POST -H "Content-Type: text/plain" \
     -d "$PAYLOAD" \
     "$FULL_URL"

echo
echo "---"
echo "Done."

package com.empower.epw.iamtest;

import org.junit.jupiter.api.Test;
import software.amazon.awssdk.services.ssm.SsmClient;
import software.amazon.awssdk.services.ssm.model.GetParameterRequest;
import software.amazon.awssdk.services.ssm.model.GetParameterResponse;

import static org.assertj.core.api.Assertions.assertThat;

public class IamRoleSsmIntegrationTest {

    @Test
    void testSsmParameterAccessibleWithDevtrunkRole() {
        SsmClient ssmClient = SsmClient.create();

        // this should be a known, non-sensitive test parameter accessible by the role
        GetParameterResponse response = ssmClient.getParameter(
                GetParameterRequest.builder()
                        .name("/scaffold/test/secret")
                        .withDecryption(true)
                        .build()
        );

        String value = response.parameter().value();

        assertThat(value)
                .isNotNull()
                .isNotEmpty();

        System.out.println("âœ… Fetched SSM parameter successfully: " + value);
    }
}
